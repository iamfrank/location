<!doctype html>
<html class="no-js" lang="en" manifest="cache.manifest">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Location</title>
        <meta name="description" content="A simple web application to track and display geolocations">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- Enable iOS standalone mode for home screen -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-title" content="Geolocation App">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">

        <link rel="stylesheet" href="css/normalize.min.css">
        <style>
            
            
            body {
                background-color: #122;
                color: #fff;
                font: 125%/1.3 Roboto, sans-serif;
                padding: 2rem;
            }
            
            dt {
                opacity: .66;
                font-size: smaller;
            }
            
            dd {
                margin: 0 0 .5rem;
                padding: 0;
            }
            
            .spinner {
                animation: spinning .33s ease 0s infinite;
                display: inline-block;
                background-color: #fff;
                width: 0.125rem;
                height: 1rem;
                margin: 0 .5rem;
            }
            
            @keyframes spinning {
                0% { transform: rotate(0deg); }
                25% { transform: rotate(0deg); }
                50% { transform: rotate(90deg); }
                75% { transform: rotate(180deg); }
                100% { transform: rotate(180deg); }
            }
            
            
        </style>
        <link rel="manifest" href="manifest.json">
        <link rel="icon" href="apple-touch-icon.png" type="image/png">
    </head>
    <body>
        <main id="location">
            <p>Retreiving location data <span class="spinner"></span></p>
        </main>
        <script>
            
            
            var geolocator = (function() {
                
                /*
                * Javascript for Geolocation webapp
                */
               
                var geo = {},
                    geo_options = {
                        enableHighAccuracy: true, 
                        maximumAge        : 30000, 
                        timeout           : 27000
                    };
                
                geo.display = document.getElementById("location");
                geo.getLocation = getLocation;
                 
                function getLocation() {
                    if ("geolocation" in navigator) {
                        navigator.geolocation.watchPosition(geo_success, geo_error, geo_options);
                    } else {
                        geo.display.innerHTML = "Geolocation is not supported by this browser.";
                    }
                }
                
                function geo_success(position) {
                    geo.display.innerHTML = "<dl><dt>Latitude</dt><dd>" + position.coords.latitude
                                + "</dd><dt>Longitude</dt><dd>" + position.coords.longitude
                                + "</dd><dt>Accuracy</dt><dd>" + position.coords.accuracy
                                + "</dd><dt>Altitude</dt><dd>" + position.coords.altitude
                                + "</dd><dt>Altitude accuracy</dt><dd>" + position.coords.altitudeAccuracy
                                + "</dd><dt>Heading</dt><dd>" + position.coords.heading
                                + "</dd><dt>Timestamp</dt><dd>" + position.coords.timestamp
                                + "</dd></dl>";
                }
                
                function geo_error(error) {
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            geo.display.innerHTML = "User denied the request for Geolocation."
                            break;
                        case error.POSITION_UNAVAILABLE:
                            geo.display.innerHTML = "Location information is unavailable."
                            break;
                        case error.TIMEOUT:
                            geo.display.innerHTML = "The request to get user location timed out."
                            break;
                        case error.UNKNOWN_ERROR:
                            geo.display.innerHTML = "An unknown error occurred."
                            break;
                        default:
                            geo.display.innerHTML = "Something strange is going on."
                    }
                }
                
                return geo;
            
            }());
           
            geolocator.getLocation();
           
           
            /*
             * Register service worker
             * (Does nothing at present. Is needed to display Chrome install web app banner.)
             */
            
            if ('serviceWorker' in navigator) {
              window.addEventListener('load', function() {
                navigator.serviceWorker.register('../dist/sw.js').then(function(registration) {
                  // Registration was successful
                  console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }).catch(function(err) {
                  // registration failed :(
                  console.log('ServiceWorker registration failed: ', err);
                });
              });
            }

            
        </script>
    </body>
</html>
